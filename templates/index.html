<!DOCTYPE html>
<html>
<head>
    <title>Receitas Deliciosas</title>
    <!-- Link para o arquivo CSS de estilos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Link para a fonte Inter do Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Meta tag para garantir a responsividade em diferentes dispositivos -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <!-- Container principal para o conteúdo da página, aplicando estilos de layout -->
    <div class="container">
        <!-- Título principal da página -->
        <h1>Receitas Deliciosas</h1>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flash-list">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        {% if current_user_id %}
            <form action="/" method="get" class="search-form">
                <input type="text" name="q" placeholder="Procure uma receita, um ingrediente, um tipo de prato ..." value="{{ q or '' }}">
                <button type="submit">Procurar</button>
            </form>
            <div class="category-bar">
                <a href="{{ url_for('index') }}" class="category {{ 'active' if not tipo }}">Todos</a>
                {% for c in categorias %}
                    <a href="{{ url_for('index', tipo=c) }}" class="category {{ 'active' if tipo==c }}">{{ c }}</a>
                {% endfor %}
            </div>
            <!-- Botões de ações -->
            <div class="actions-bar">
                <button onclick="window.location.href='{{ url_for('nova_receita') }}'" class="add-recipe-button button-link btn-primary">Adicionar Nova Receita</button>
                <button onclick="window.location.href='{{ url_for('meus_favoritos') }}'" class="button-link btn-accent">Favoritos</button>
                <button onclick="window.location.href='{{ url_for('notificacoes') }}'" class="button-link btn-info">Notificações</button>
                <button onclick="window.location.href='{{ url_for('logout') }}'" class="button-link">Sair</button>
            </div>
            <!-- Lista de receitas -->
            <button onclick="window.location.href='{{ url_for('meus_favoritos') }}'" class="button-link btn-accent">Minhas Receitas Favoritas</button>
            <ul>
                {% for r in receitas %}
                    <li>
                        <span>
                            <a href="{{ url_for('receita_detail', id=r.id) }}">{{ r.titulo }}</a>
                            <span class="badge">{{ r.tipo or 'Outros' }}</span>
                        </span>
                        {% if current_user_id == r.usuario_id %}
                        <span>
                            <a class="button-link edit-button" href="{{ url_for('editar_receita', id=r.id) }}">Editar</a>
                            <button class="button-link delete-button" onclick="confirmDelete{{ r.id }}()">Excluir</button>
                        </span>
                        <script>
                            function confirmDelete{{ r.id }}(){
                                if(confirm('Tem certeza que deseja excluir esta receita?')){
                                    const f=document.createElement('form');
                                    f.method='POST';
                                    f.action='{{ url_for('excluir_receita', id=r.id) }}';
                                    document.body.appendChild(f);f.submit();
                                }
                            }
                        </script>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <!-- Tela inicial para visitantes: formulário de cadastro -->
            <div class="auth-card">
                <form action="{{ url_for('registrar') }}" method="POST" class="register-form">
                    <label for="nome">Nome*</label>
                    <input type="text" id="nome" name="nome" placeholder="Nome" required>

                    <label for="email">E-mail*</label>
                    <input type="email" id="email" name="email" placeholder="E-mail" required>

                    <label for="senha">Senha</label>
                    <input type="password" id="senha" name="senha" placeholder="Senha" required>

                    <label for="confirmacao_senha">Confirmação da Senha</label>
                    <input type="password" id="confirmacao_senha" name="confirmacao_senha" placeholder="Confirmação da Senha">

                    <button type="submit" class="button-link btn-primary">Cadastrar ></button>
                </form>
                <p class="auth-footer">Já tenho uma conta, <a href="{{ url_for('login') }}">logar</a>.</p>
            </div>
        {% endif %}
    </div>
</body>
</html>
